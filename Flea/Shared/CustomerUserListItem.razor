@using Flea.Models
@using Customer = Flea.Models.Customer

<div class="customer-li">
    <div class="txt">ID: @Customer.Id.ToString().PadLeft(4, '0')</div>
    <div class="txt">Navn: @Customer.Name</div>
    <div class="txt">Tlf.: @Customer.PhoneNumber</div>
    <button class="button button--outline del-button" @onclick="Delete">Slet</button>
    <Modal ButtonName="Rediger" @ref="_modal">
        <CustomerForm Customer="_temp" OnValidSubmit="OnSubmit" Modal="_modal"></CustomerForm>
    </Modal>
</div>

@code {
    private Modal _modal = null!;
    private Customer _temp = new(0);
    private Customer _customer;

    [Parameter]
    public Customer Customer
    {
        get => _customer;
        set
        {
            _customer = value;
            _temp = Customer.Clone();
        }
    }
    
    [Parameter]
    public EventCallback<Customer> OnDelete { get; set; }

    [Parameter]
    public EventCallback<EditContext> OnEdit { get; set; }

    public async Task Delete()
    {
        await OnDelete.InvokeAsync(Customer);
    }

    public async Task OnSubmit(EditContext context)
    {
        _modal.ModalCancel();

        Customer.Name = _temp.Name;
        _customer.PhoneNumber = _temp.PhoneNumber;
        
        await OnEdit.InvokeAsync(context);
    }
}