@using Flea.Models
@using Flea.Utility
@using Customer = Flea.Models.Customer

<div class="customer-li">
    <div class="txt">@Customer.Id.ToString().PadLeft(4, '0')</div>
    <div class="txt">@Customer.Name @(Customer.Nickname.Length > 0 ? $"({Customer.Nickname})" : "")</div>
    <div class="txt">+45 @Customer.PhoneNumber</div>
    <button class="button button--outline del-button" @onclick="Delete">Slet</button>
    <Modal ButtonCSS="button button--outline create-button" ButtonName="Rediger" @ref="_modal">
        <CustomerForm Customer="_temp" OnValidSubmit="OnSubmit" Modal="_modal"></CustomerForm>
    </Modal>
</div>

@code {
    private Modal _modal = null!;
    private Customer _temp = new(0);
    private Customer _customer = null!;

    [Parameter]
    public Customer Customer
    {
        get => _customer;
        set
        {
            _customer = value;
            this.CheckParameter(Customer, nameof(Customer));
            _temp = Customer.Clone();
        }
    }
    
    [Parameter, RequiredParameter]
    public EventCallback<Customer> OnDelete { get; set; }

    [Parameter, RequiredParameter]
    public EventCallback<EditContext> OnEdit { get; set; }

    private async Task Delete()
    {
        await OnDelete.InvokeAsync(Customer);
    }

    private async Task OnSubmit(EditContext context)
    {
        _modal.ModalCancel();

        Customer.Name = _temp.Name;
        _customer.PhoneNumber = _temp.PhoneNumber;
        
        await OnEdit.InvokeAsync(context);
    }

    protected override Task OnInitializedAsync()
    {
        ParameterChecker.CheckParameters(this);
        return base.OnInitializedAsync();
    }

}